# C# Notes

## How to see what dependencies are installed

`dotnet list package`

## How to remove a dependency

`dotnet remove package (package name)`

## Reverse engineering a remote database

There are some
[tools](https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/dotnet) which
allow us to reverse engineer the models defined in our database. To to this
ensure that you have the tool installed `dotnet tool install --global dotnet-ef` and then
run the command:  
`dotnet ef dbcontext scaffold "server=localhost:3306;database=Wiki;user=root;password=muhR00T!" Pomelo.EntityFrameworkCore.MySql -o Model`

## Data

### Trim

Typically objects from FE may or may not come with their values trimmed. If you're taking it as a model a recommendation would be do use a backing field:

```c#
public class Pages
{
    public int PageID { get; set; }

    private string _folderName;
    public string FolderName
    {
        get { return _folderName; }
        //The ? checks for nulls.
        set { _folderName = value?.Trim(); }
    }
}
```

## Testing

Typically for tests what I do is:

```c#
//Test File
        [Theory]
        [ClassData(typeof(CreateUserAsAdminTestData))]
        public void HasPermissionToMakeUser_ShouldMakeAdmin_WithValidParams(UserToCreateModel userToCreateModel, bool expected)
        {
            var userServiceSut = instantiateUserService();
            var sampleAdminUser = new UserModel
            {
                Id = 1,
                UserRoles = new UserRoleModel[]
                {
                    new UserRoleModel
                    {
                        Id = 1,
                        RoleId = (int) Constants.Role.Admin
                    }
                }
            };
            mockUserRepository.Setup(s => s.GetUserIdBySub()).Returns(Task.FromResult(sampleAdminUser));
            var result = userServiceSut.HasPermissionToMakeUser(userToCreateModel).Result;

            Assert.Equal(expected, result);
        }
// Test Data file
    class CreateUserAsHi55AdminTestData : IEnumerable<object[]>
    {
        public IEnumerator<object[]> GetEnumerator()
        {
            yield return new object[] { new UserToCreateModel { CompanyId = 1, RoleId = (int) Constants.Role.Owner }, true };
            yield return new object[] { new UserToCreateModel { CompanyId = 1, RoleId = (int) Constants.Role.User }, true};

            yield return new object[] { new UserToCreateModel { CompanyId = 2, RoleId = (int) Constants.Role.Owner }, true };
            yield return new object[] { new UserToCreateModel { CompanyId = 2, RoleId = (int) Constants.Role.User }, true };
        }

        IEnumerator IEnumerable.GetEnumerator() => GetEnumerator();
    }
```

### Useful libraries

| Id  | Tool             | Use                                                                                                    | Link                                                                       |
| --- | ---------------- | ------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------- |
| 1   | NSubstitute      | Tool is used like Moq: See code example [here](#nsubstitute-example).                                  | [Getting Started](https://nsubstitute.github.io/help/getting-started/)     |
| 2   | AutoFixture      | Helps reduce the Arrange part of tests by helping create objects. [See example](#autofixture-example). | [Cheat Sheet](https://github.com/AutoFixture/AutoFixture/wiki/Cheat-Sheet) |
| 3   | FluentAssertions | Makes asserts a bit more readable basically. [See example](#fluentassertions-example)                  | [Docs](https://fluentassertions.com/introduction)                          |

### NSubstitute Example

``` c#
//Create:
private readonly ICalculator _calculator = Substitute.For<ICalculator>();
var calculator = Substitute.For<ICalculator>();

//Set a return value:
calculator.Add(1, 2).Returns(3);
Assert.AreEqual(3, calculator.Add(1, 2));

//Check received calls:
calculator.Received().Add(1, Arg.Any<int>());
calculator.DidNotReceive().Add(2, 2);

//Raise events
calculator.PoweringUp += Raise.Event();

```

### AutoFixture Example

``` c#
private readonly IFixture _fixture = new Fixture();
var userId  = 1;
var autoGeneratedClass =
    _fixture
    .Build<User>()
    .With(c => c.Id, userId)
    .Create();
```

### FluentAssertions Example

``` c#
string actual = "ABCDEFGHI";
actual.Should().StartWith("AB").And.EndWith("HI").And.Contain("EF").And.HaveLength(9);


//Exceptions with Fluent Assertions
var recipe = new RecipeBuilder()
                    .With(new IngredientBuilder().For("Milk").WithQuantity(200, Unit.Milliliters))
                    .Build();
Action action = () => recipe.AddIngredient("Milk", 100, Unit.Spoon);
action
                    .Should().Throw<RuleViolationException>()
                    .WithMessage("*change the unit of an existing ingredient*")
                    .And.Violations.Should().Contain(BusinessRule.CannotChangeIngredientQuantity);

```
